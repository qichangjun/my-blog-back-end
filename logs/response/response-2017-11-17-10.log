[2017-11-17 10:01:18.452] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":2,"pageSize":"10","sortField":"lastReplyTime","totalElement":"14","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 200
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 14\n  }\n}"
*************** response log end ***************

[2017-11-17 10:01:18.462] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 29
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:01:18.472] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 204
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:01:18.470Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:01:31.194] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":2,"pageSize":"10","sortField":"lastReplyTime","totalElement":"14","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 8
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 14\n  }\n}"
*************** response log end ***************

[2017-11-17 10:01:31.196] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:01:31.195Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:01:31.202] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:01:35.037] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":2,"pageSize":"10","sortField":"lastReplyTime","totalElement":"14","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 14\n  }\n}"
*************** response log end ***************

[2017-11-17 10:01:35.042] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:01:35.042] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 7
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:01:35.041Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:01:40.116] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":2,"pageSize":"10","sortField":"lastReplyTime","totalElement":"14","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 8
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 14\n  }\n}"
*************** response log end ***************

[2017-11-17 10:01:40.125] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:01:40.125Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:01:40.147] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:01:49.131] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":2,"pageSize":"10","sortField":"lastReplyTime","totalElement":"14","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 14\n  }\n}"
*************** response log end ***************

[2017-11-17 10:01:49.133] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:01:49.133Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:01:49.138] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:02:17.414] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":2,"pageSize":"10","sortField":"lastReplyTime","totalElement":"14","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 9
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 14\n  }\n}"
*************** response log end ***************

[2017-11-17 10:02:17.417] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:02:17.417] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 8
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:02:17.416Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:02:26.739] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":2,"pageSize":"10","sortField":"lastReplyTime","totalElement":"14","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 14\n  }\n}"
*************** response log end ***************

[2017-11-17 10:02:26.746] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:02:26.844] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:02:26.843Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:02:31.048] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":"10","sortField":"lastReplyTime","totalElement":"14","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 8
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a04050036119115add2f7f7\",\n        \"title\": \"2\",\n        \"content\": \"2\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"lastReplyTime\": \"2017-11-16T04:02:30.711Z\",\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"222\",\n            \"_id\": \"5a0d0dd60000ef0ab9fed789\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-16T04:02:30.711Z\"\n          }\n        ],\n        \"replyNum\": 1,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:24.384Z\"\n      },\n      {\n        \"_id\": \"5a0404fd36119115add2f7f6\",\n        \"title\": \"1\",\n        \"content\": \"1\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"lastReplyTime\": \"2017-11-16T04:02:23.128Z\",\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"111\",\n            \"_id\": \"5a0d0dcf0000ef0ab9fed788\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-16T04:02:23.135Z\"\n          }\n        ],\n        \"replyNum\": 1,\n        \"viewed\": 8,\n        \"creatDate\": \"2017-11-09T07:34:21.305Z\"\n      },\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 266,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050336119115add2f7f8\",\n        \"title\": \"3\",\n        \"content\": \"3\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:27.304Z\"\n      },\n      {\n        \"_id\": \"5a04050736119115add2f7f9\",\n        \"title\": \"4\",\n        \"content\": \"4\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:31.152Z\"\n      },\n      {\n        \"_id\": \"5a04050a36119115add2f7fa\",\n        \"title\": \"5\",\n        \"content\": \"5\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:34.776Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      }\n    ],\n    \"totalElement\": 14\n  }\n}"
*************** response log end ***************

[2017-11-17 10:02:33.240] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/deleteArticle
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0","id":"5a04050036119115add2f7f7"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"数据库错误\",\n  \"data\": \"ReferenceError: getParams is not defined\"\n}"
*************** response log end ***************

[2017-11-17 10:02:55.192] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/deleteArticle
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0","id":"5a04050036119115add2f7f7"}
response time: 54
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a04050036119115add2f7f7\",\n    \"title\": \"2\",\n    \"content\": \"2\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"lastReplyTime\": \"2017-11-16T04:02:30.711Z\",\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"222\",\n        \"_id\": \"5a0d0dd60000ef0ab9fed789\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-16T04:02:30.711Z\"\n      }\n    ],\n    \"replyNum\": 1,\n    \"viewed\": 1,\n    \"creatDate\": \"2017-11-09T07:34:24.384Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:02:55.665] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:03:05.661] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":2,"pageSize":"10","sortField":"lastReplyTime","totalElement":"14","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 13
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 13\n  }\n}"
*************** response log end ***************

[2017-11-17 10:03:06.597] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":"10","sortField":"lastReplyTime","totalElement":"13","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 8
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0404fd36119115add2f7f6\",\n        \"title\": \"1\",\n        \"content\": \"1\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"lastReplyTime\": \"2017-11-16T04:02:23.128Z\",\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"111\",\n            \"_id\": \"5a0d0dcf0000ef0ab9fed788\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-16T04:02:23.135Z\"\n          }\n        ],\n        \"replyNum\": 1,\n        \"viewed\": 8,\n        \"creatDate\": \"2017-11-09T07:34:21.305Z\"\n      },\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 266,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050336119115add2f7f8\",\n        \"title\": \"3\",\n        \"content\": \"3\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:27.304Z\"\n      },\n      {\n        \"_id\": \"5a04050736119115add2f7f9\",\n        \"title\": \"4\",\n        \"content\": \"4\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:31.152Z\"\n      },\n      {\n        \"_id\": \"5a04050a36119115add2f7fa\",\n        \"title\": \"5\",\n        \"content\": \"5\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:34.776Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      }\n    ],\n    \"totalElement\": 13\n  }\n}"
*************** response log end ***************

[2017-11-17 10:05:24.282] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":"10","sortField":"lastReplyTime","totalElement":"13","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 28
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0404fd36119115add2f7f6\",\n        \"title\": \"1\",\n        \"content\": \"1\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"lastReplyTime\": \"2017-11-16T04:02:23.128Z\",\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"111\",\n            \"_id\": \"5a0d0dcf0000ef0ab9fed788\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-16T04:02:23.135Z\"\n          }\n        ],\n        \"replyNum\": 1,\n        \"viewed\": 8,\n        \"creatDate\": \"2017-11-09T07:34:21.305Z\"\n      },\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 266,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050336119115add2f7f8\",\n        \"title\": \"3\",\n        \"content\": \"3\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:27.304Z\"\n      },\n      {\n        \"_id\": \"5a04050736119115add2f7f9\",\n        \"title\": \"4\",\n        \"content\": \"4\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:31.152Z\"\n      },\n      {\n        \"_id\": \"5a04050a36119115add2f7fa\",\n        \"title\": \"5\",\n        \"content\": \"5\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:34.776Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      }\n    ],\n    \"totalElement\": 13\n  }\n}"
*************** response log end ***************

[2017-11-17 10:05:24.292] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 35
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:05:24.290Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:05:24.314] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 25
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:05:26.728] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/deleteArticle
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0","id":"5a0404fd36119115add2f7f6"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0404fd36119115add2f7f6\",\n    \"title\": \"1\",\n    \"content\": \"1\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"lastReplyTime\": \"2017-11-16T04:02:23.128Z\",\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"111\",\n        \"_id\": \"5a0d0dcf0000ef0ab9fed788\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-16T04:02:23.135Z\"\n      }\n    ],\n    \"replyNum\": 1,\n    \"viewed\": 8,\n    \"creatDate\": \"2017-11-09T07:34:21.305Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:05:27.195] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":"10","sortField":"lastReplyTime","totalElement":13,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 266,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050336119115add2f7f8\",\n        \"title\": \"3\",\n        \"content\": \"3\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:27.304Z\"\n      },\n      {\n        \"_id\": \"5a04050736119115add2f7f9\",\n        \"title\": \"4\",\n        \"content\": \"4\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:31.152Z\"\n      },\n      {\n        \"_id\": \"5a04050a36119115add2f7fa\",\n        \"title\": \"5\",\n        \"content\": \"5\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:34.776Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      }\n    ],\n    \"totalElement\": 12\n  }\n}"
*************** response log end ***************

[2017-11-17 10:05:30.591] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/deleteArticle
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0","id":"5a04050336119115add2f7f8"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a04050336119115add2f7f8\",\n    \"title\": \"3\",\n    \"content\": \"3\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [],\n    \"replyNum\": 0,\n    \"viewed\": 0,\n    \"creatDate\": \"2017-11-09T07:34:27.304Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:05:31.030] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":"10","sortField":"lastReplyTime","totalElement":12,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 266,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050736119115add2f7f9\",\n        \"title\": \"4\",\n        \"content\": \"4\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:31.152Z\"\n      },\n      {\n        \"_id\": \"5a04050a36119115add2f7fa\",\n        \"title\": \"5\",\n        \"content\": \"5\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:34.776Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      }\n    ],\n    \"totalElement\": 11\n  }\n}"
*************** response log end ***************

[2017-11-17 10:05:32.915] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/deleteArticle
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0","id":"5a04050736119115add2f7f9"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a04050736119115add2f7f9\",\n    \"title\": \"4\",\n    \"content\": \"4\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [],\n    \"replyNum\": 0,\n    \"viewed\": 0,\n    \"creatDate\": \"2017-11-09T07:34:31.152Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:05:33.367] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":"10","sortField":"lastReplyTime","totalElement":11,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 7
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 266,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050a36119115add2f7fa\",\n        \"title\": \"5\",\n        \"content\": \"5\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:34.776Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 10\n  }\n}"
*************** response log end ***************

[2017-11-17 10:05:34.709] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/deleteArticle
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0","id":"5a04050a36119115add2f7fa"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a04050a36119115add2f7fa\",\n    \"title\": \"5\",\n    \"content\": \"5\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [],\n    \"replyNum\": 0,\n    \"viewed\": 1,\n    \"creatDate\": \"2017-11-09T07:34:34.776Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:05:35.167] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":"10","sortField":"lastReplyTime","totalElement":10,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODgzOTEzLCJleHAiOjE1MTA5MjcxMTN9.Nu5R38ZJ5OnA0S_bA1aH8sZhRGChiISD6KbRz4UX1N0"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 266,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:07:14.486] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/users/login
request client ip:  ::1
request body: 
{"userName":"qichangjun","password":"123abc"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"success\",\n  \"data\": {\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDM0LCJleHAiOjE1MTA5Mjc2MzR9.laSpm3f3YIgGA_Smdag8ez3WcVaNc8QYt4VIm_kvtfk\",\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:07:43.065] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/users/login
request client ip:  ::1
request body: 
{"userName":"qichangjun","password":"123abc"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"success\",\n  \"data\": {\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA\",\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:07:43.348] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 266,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:07:44.847] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 7
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 266,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:07:44.851] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:07:44.851Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:07:44.852] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:07:52.426] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 266,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:07:52.429] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:07:52.429Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:07:52.431] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:09:17.136] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 266,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:09:17.140] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:09:17.140Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:09:17.143] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:09:36.741] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 7
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 266,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:09:36.745] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:09:36.745Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:09:36.749] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:10:01.593] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/updateCheckTimes
request client ip:  ::1
request body: 
{"id":"5a0183c8ec9e0358be71b6b4","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 17
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n    \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n    \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"Mark\\n\",\n        \"_id\": \"5a027dec1454aa15ea3fc089\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02af461454aa15ea3fc090\",\n            \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"_id\": \"5a03d8e272bf56102f97ca73\",\n            \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"滴滴答答滴滴答答的\",\n        \"_id\": \"5a027df61454aa15ea3fc08a\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n        \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n        \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n        \"_id\": \"5a03da8772bf56102f97ca75\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdw\",\n        \"_id\": \"5a051ec1d89b7f51860b0c24\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n      }\n    ],\n    \"replyNum\": 7,\n    \"viewed\": 267,\n    \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:10:01.615] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/art/getArticleDetail?id=5a0183c8ec9e0358be71b6b4
request client ip:  ::1
request query:  {"id":"5a0183c8ec9e0358be71b6b4"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n    \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n    \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"Mark\\n\",\n        \"_id\": \"5a027dec1454aa15ea3fc089\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02af461454aa15ea3fc090\",\n            \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"_id\": \"5a03d8e272bf56102f97ca73\",\n            \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"滴滴答答滴滴答答的\",\n        \"_id\": \"5a027df61454aa15ea3fc08a\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n        \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n        \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n        \"_id\": \"5a03da8772bf56102f97ca75\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdw\",\n        \"_id\": \"5a051ec1d89b7f51860b0c24\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n      }\n    ],\n    \"replyNum\": 7,\n    \"viewed\": 267,\n    \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:10:01.933] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /uploads/album/369f24f883537.jpg
request client ip:  ::1
request query:  {}
response time: 16
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"error\"\n}"
*************** response log end ***************

[2017-11-17 10:10:01.934] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /uploads/album/057c71634a756.jpg
request client ip:  ::1
request query:  {}
response time: 19
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"error\"\n}"
*************** response log end ***************

[2017-11-17 10:10:03.250] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 267,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:10:04.358] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/art/getArticleDetail?id=5a0183c8ec9e0358be71b6b4
request client ip:  ::1
request query:  {"id":"5a0183c8ec9e0358be71b6b4"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n    \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n    \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"Mark\\n\",\n        \"_id\": \"5a027dec1454aa15ea3fc089\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02af461454aa15ea3fc090\",\n            \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"_id\": \"5a03d8e272bf56102f97ca73\",\n            \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"滴滴答答滴滴答答的\",\n        \"_id\": \"5a027df61454aa15ea3fc08a\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n        \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n        \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n        \"_id\": \"5a03da8772bf56102f97ca75\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdw\",\n        \"_id\": \"5a051ec1d89b7f51860b0c24\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n      }\n    ],\n    \"replyNum\": 7,\n    \"viewed\": 267,\n    \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:10:04.361] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/updateCheckTimes
request client ip:  ::1
request body: 
{"id":"5a0183c8ec9e0358be71b6b4","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 11
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n    \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n    \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"Mark\\n\",\n        \"_id\": \"5a027dec1454aa15ea3fc089\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02af461454aa15ea3fc090\",\n            \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"_id\": \"5a03d8e272bf56102f97ca73\",\n            \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"滴滴答答滴滴答答的\",\n        \"_id\": \"5a027df61454aa15ea3fc08a\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n        \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n        \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n        \"_id\": \"5a03da8772bf56102f97ca75\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdw\",\n        \"_id\": \"5a051ec1d89b7f51860b0c24\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n      }\n    ],\n    \"replyNum\": 7,\n    \"viewed\": 268,\n    \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:10:04.492] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /uploads/album/057c71634a756.jpg
request client ip:  ::1
request query:  {}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"error\"\n}"
*************** response log end ***************

[2017-11-17 10:10:04.492] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /uploads/album/369f24f883537.jpg
request client ip:  ::1
request query:  {}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"error\"\n}"
*************** response log end ***************

[2017-11-17 10:10:45.727] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/updateCheckTimes
request client ip:  ::1
request body: 
{"id":"5a0183c8ec9e0358be71b6b4","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n    \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n    \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"Mark\\n\",\n        \"_id\": \"5a027dec1454aa15ea3fc089\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02af461454aa15ea3fc090\",\n            \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"_id\": \"5a03d8e272bf56102f97ca73\",\n            \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"滴滴答答滴滴答答的\",\n        \"_id\": \"5a027df61454aa15ea3fc08a\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n        \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n        \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n        \"_id\": \"5a03da8772bf56102f97ca75\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdw\",\n        \"_id\": \"5a051ec1d89b7f51860b0c24\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n      }\n    ],\n    \"replyNum\": 7,\n    \"viewed\": 269,\n    \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:10:45.730] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/art/getArticleDetail?id=5a0183c8ec9e0358be71b6b4
request client ip:  ::1
request query:  {"id":"5a0183c8ec9e0358be71b6b4"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n    \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n    \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"Mark\\n\",\n        \"_id\": \"5a027dec1454aa15ea3fc089\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02af461454aa15ea3fc090\",\n            \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"_id\": \"5a03d8e272bf56102f97ca73\",\n            \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"滴滴答答滴滴答答的\",\n        \"_id\": \"5a027df61454aa15ea3fc08a\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n        \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n        \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n        \"_id\": \"5a03da8772bf56102f97ca75\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdw\",\n        \"_id\": \"5a051ec1d89b7f51860b0c24\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n      }\n    ],\n    \"replyNum\": 7,\n    \"viewed\": 269,\n    \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:10:45.933] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /uploads/album/057c71634a756.jpg
request client ip:  ::1
request query:  {}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"error\"\n}"
*************** response log end ***************

[2017-11-17 10:10:45.935] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /uploads/album/369f24f883537.jpg
request client ip:  ::1
request query:  {}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"error\"\n}"
*************** response log end ***************

[2017-11-17 10:10:46.367] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:10:46.371] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 8
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:10:46.371Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:10:46.373] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:11:33.583] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 8
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:11:33.586] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:11:33.586Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:11:33.594] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:11:43.218] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:11:43.226] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:11:43.228] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:11:43.228Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:11:43.232] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:11:49.843] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:11:49.853] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:11:49.856] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:11:49.855Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:11:49.860] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:12:00.945] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:12:00.950] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:12:00.950Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:12:00.959] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:12:03.775] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:12:03.779] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:12:03.779Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:12:03.781] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:12:14.862] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":null,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:12:14.865] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:12:14.865Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:12:14.866] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:12:22.899] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":null,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:12:22.902] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:12:22.902Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:12:22.908] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:12:26.335] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":{"userName":"qichangjun"},"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:12:26.340] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:12:26.340Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:12:26.348] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:12:39.307] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":{"userName":"qichangjun"},"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:12:39.311] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:12:39.310Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:12:39.312] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:13:03.850] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":{"userName":"qichangjun"},"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 7
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:13:03.855] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:13:03.855Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:13:03.857] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:13:22.634] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:13:22.633Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:13:22.641] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:13:22.648] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":{"userName":"qichangjun"},"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:13:25.099] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:13:25.098Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:13:25.108] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:13:25.119] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":{"userName":"qichangjun"},"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:13:27.475] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA
request client ip:  ::1
request query:  {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"_id\": \"59fbe0f5ce880907c20b59ce\",\n    \"userName\": \"qichangjun\",\n    \"password\": \"********\",\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA\",\n    \"__v\": 0,\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:13:27.474Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:13:27.480] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:13:27.489] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":{"userName":"qichangjun"},"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:13:50.670] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA
request client ip:  ::1
request query:  {"userName":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"参数不正确\"\n}"
*************** response log end ***************

[2017-11-17 10:13:50.675] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:13:50.683] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":{"userName":"qichangjun"},"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:13:59.215] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA
request client ip:  ::1
request query:  {"userName":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"参数不正确\"\n}"
*************** response log end ***************

[2017-11-17 10:13:59.220] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:13:59.227] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":{"userName":"qichangjun"},"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:14:03.113] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo
request client ip:  ::1
request query:  {}
response time: 0
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"参数不正确\"\n}"
*************** response log end ***************

[2017-11-17 10:14:03.118] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:14:03.128] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":{"userName":"qichangjun"},"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:14:16.380] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo
request client ip:  ::1
request query:  {}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"参数不正确\"\n}"
*************** response log end ***************

[2017-11-17 10:14:16.384] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:14:16.393] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:14:19.424] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"参数不正确\"\n}"
*************** response log end ***************

[2017-11-17 10:14:19.429] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:14:19.435] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:14:27.679] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 0
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"参数不正确\"\n}"
*************** response log end ***************

[2017-11-17 10:14:27.685] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"0":"q","1":"i","2":"c","3":"h","4":"a","5":"n","6":"g","7":"j","8":"u","9":"n","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:14:27.691] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:14:35.097] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"参数不正确\"\n}"
*************** response log end ***************

[2017-11-17 10:14:35.118] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:14:47.650] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 0
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"参数不正确\"\n}"
*************** response log end ***************

[2017-11-17 10:14:47.658] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:14:47.670] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 7
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:14:50.769] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"参数不正确\"\n}"
*************** response log end ***************

[2017-11-17 10:14:50.774] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:14:50.782] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:15:00.979] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 0
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"参数不正确\"\n}"
*************** response log end ***************

[2017-11-17 10:15:00.988] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:15:09.022] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"参数不正确\"\n}"
*************** response log end ***************

[2017-11-17 10:15:09.027] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:15:09.036] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:17:04.824] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 19
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:17:04.830] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 35
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:17:04.830] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 84
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:17:04.829Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:17:23.256] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 7
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:17:23.256Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:17:23.258] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:17:23.267] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 8
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:17:46.936] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 0
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"参数不正确\"\n}"
*************** response log end ***************

[2017-11-17 10:17:46.938] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:17:46.937Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:17:46.949] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 8
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:18:31.659] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 33
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:18:31.657Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:18:31.668] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 28
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:18:31.674] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 26
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:18:45.078] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 13
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 269,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:18:46.603] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/updateCheckTimes
request client ip:  ::1
request body: 
{"id":"5a0183c8ec9e0358be71b6b4","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 22
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n    \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n    \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"Mark\\n\",\n        \"_id\": \"5a027dec1454aa15ea3fc089\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02af461454aa15ea3fc090\",\n            \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"_id\": \"5a03d8e272bf56102f97ca73\",\n            \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"滴滴答答滴滴答答的\",\n        \"_id\": \"5a027df61454aa15ea3fc08a\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n        \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n        \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n        \"_id\": \"5a03da8772bf56102f97ca75\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdw\",\n        \"_id\": \"5a051ec1d89b7f51860b0c24\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n      }\n    ],\n    \"replyNum\": 7,\n    \"viewed\": 270,\n    \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:18:46.608] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/art/getArticleDetail?id=5a0183c8ec9e0358be71b6b4
request client ip:  ::1
request query:  {"id":"5a0183c8ec9e0358be71b6b4"}
response time: 22
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n    \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n    \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"Mark\\n\",\n        \"_id\": \"5a027dec1454aa15ea3fc089\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02af461454aa15ea3fc090\",\n            \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"_id\": \"5a03d8e272bf56102f97ca73\",\n            \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"滴滴答答滴滴答答的\",\n        \"_id\": \"5a027df61454aa15ea3fc08a\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n        \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n        \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n        \"_id\": \"5a03da8772bf56102f97ca75\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdw\",\n        \"_id\": \"5a051ec1d89b7f51860b0c24\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n      }\n    ],\n    \"replyNum\": 7,\n    \"viewed\": 270,\n    \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:18:46.751] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /uploads/album/057c71634a756.jpg
request client ip:  ::1
request query:  {}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"error\"\n}"
*************** response log end ***************

[2017-11-17 10:18:46.753] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /uploads/album/369f24f883537.jpg
request client ip:  ::1
request query:  {}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"error\"\n}"
*************** response log end ***************

[2017-11-17 10:19:47.367] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/updateCheckTimes
request client ip:  ::1
request body: 
{"id":"5a0183c8ec9e0358be71b6b4","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 8
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n    \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n    \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"Mark\\n\",\n        \"_id\": \"5a027dec1454aa15ea3fc089\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02af461454aa15ea3fc090\",\n            \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"_id\": \"5a03d8e272bf56102f97ca73\",\n            \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"滴滴答答滴滴答答的\",\n        \"_id\": \"5a027df61454aa15ea3fc08a\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n        \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n        \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n        \"_id\": \"5a03da8772bf56102f97ca75\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdw\",\n        \"_id\": \"5a051ec1d89b7f51860b0c24\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n      }\n    ],\n    \"replyNum\": 7,\n    \"viewed\": 271,\n    \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:19:47.370] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/art/getArticleDetail?id=5a0183c8ec9e0358be71b6b4
request client ip:  ::1
request query:  {"id":"5a0183c8ec9e0358be71b6b4"}
response time: 8
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n    \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n    \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"Mark\\n\",\n        \"_id\": \"5a027dec1454aa15ea3fc089\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02af461454aa15ea3fc090\",\n            \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"_id\": \"5a03d8e272bf56102f97ca73\",\n            \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"滴滴答答滴滴答答的\",\n        \"_id\": \"5a027df61454aa15ea3fc08a\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n        \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n        \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n        \"_id\": \"5a03da8772bf56102f97ca75\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdw\",\n        \"_id\": \"5a051ec1d89b7f51860b0c24\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n      }\n    ],\n    \"replyNum\": 7,\n    \"viewed\": 271,\n    \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:19:47.557] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /uploads/album/057c71634a756.jpg
request client ip:  ::1
request query:  {}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"error\"\n}"
*************** response log end ***************

[2017-11-17 10:19:47.557] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /uploads/album/369f24f883537.jpg
request client ip:  ::1
request query:  {}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"error\"\n}"
*************** response log end ***************

[2017-11-17 10:19:56.558] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/updateCheckTimes
request client ip:  ::1
request body: 
{"id":"5a0183c8ec9e0358be71b6b4","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n    \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n    \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"Mark\\n\",\n        \"_id\": \"5a027dec1454aa15ea3fc089\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02af461454aa15ea3fc090\",\n            \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"_id\": \"5a03d8e272bf56102f97ca73\",\n            \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"滴滴答答滴滴答答的\",\n        \"_id\": \"5a027df61454aa15ea3fc08a\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n        \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n        \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n        \"_id\": \"5a03da8772bf56102f97ca75\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdw\",\n        \"_id\": \"5a051ec1d89b7f51860b0c24\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n      }\n    ],\n    \"replyNum\": 7,\n    \"viewed\": 272,\n    \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:19:56.561] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/art/getArticleDetail?id=5a0183c8ec9e0358be71b6b4
request client ip:  ::1
request query:  {"id":"5a0183c8ec9e0358be71b6b4"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n    \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n    \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"Mark\\n\",\n        \"_id\": \"5a027dec1454aa15ea3fc089\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02af461454aa15ea3fc090\",\n            \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"_id\": \"5a03d8e272bf56102f97ca73\",\n            \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"滴滴答答滴滴答答的\",\n        \"_id\": \"5a027df61454aa15ea3fc08a\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n        \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n        \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n        \"_id\": \"5a03da8772bf56102f97ca75\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdw\",\n        \"_id\": \"5a051ec1d89b7f51860b0c24\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n      }\n    ],\n    \"replyNum\": 7,\n    \"viewed\": 272,\n    \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:19:56.743] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /uploads/album/057c71634a756.jpg
request client ip:  ::1
request query:  {}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"error\"\n}"
*************** response log end ***************

[2017-11-17 10:19:56.744] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /uploads/album/369f24f883537.jpg
request client ip:  ::1
request query:  {}
response time: 0
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"error\"\n}"
*************** response log end ***************

[2017-11-17 10:20:00.531] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/updateCheckTimes
request client ip:  ::1
request body: 
{"id":"5a0183c8ec9e0358be71b6b4","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n    \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n    \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"Mark\\n\",\n        \"_id\": \"5a027dec1454aa15ea3fc089\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02af461454aa15ea3fc090\",\n            \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"_id\": \"5a03d8e272bf56102f97ca73\",\n            \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"滴滴答答滴滴答答的\",\n        \"_id\": \"5a027df61454aa15ea3fc08a\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n        \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n        \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n        \"_id\": \"5a03da8772bf56102f97ca75\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdw\",\n        \"_id\": \"5a051ec1d89b7f51860b0c24\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n      }\n    ],\n    \"replyNum\": 7,\n    \"viewed\": 273,\n    \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:20:00.541] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/art/getArticleDetail?id=5a0183c8ec9e0358be71b6b4
request client ip:  ::1
request query:  {"id":"5a0183c8ec9e0358be71b6b4"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n    \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n    \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"Mark\\n\",\n        \"_id\": \"5a027dec1454aa15ea3fc089\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02af461454aa15ea3fc090\",\n            \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"_id\": \"5a03d8e272bf56102f97ca73\",\n            \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"滴滴答答滴滴答答的\",\n        \"_id\": \"5a027df61454aa15ea3fc08a\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n        \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n        \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n        \"_id\": \"5a03da8772bf56102f97ca75\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdw\",\n        \"_id\": \"5a051ec1d89b7f51860b0c24\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n      }\n    ],\n    \"replyNum\": 7,\n    \"viewed\": 273,\n    \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:20:00.736] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /uploads/album/057c71634a756.jpg
request client ip:  ::1
request query:  {}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"error\"\n}"
*************** response log end ***************

[2017-11-17 10:20:00.738] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /uploads/album/369f24f883537.jpg
request client ip:  ::1
request query:  {}
response time: 0
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"error\"\n}"
*************** response log end ***************

[2017-11-17 10:20:02.348] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 273,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:20:04.199] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=admin
request client ip:  ::1
request query:  {"userName":"admin"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:20:04.199Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:20:04.207] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"admin"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n      \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n      \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [\n        {\n          \"userName\": \"admin\",\n          \"content\": \"Mark\\n\",\n          \"_id\": \"5a027dec1454aa15ea3fc089\",\n          \"replyChildList\": [\n            {\n              \"userName\": \"admin\",\n              \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n              \"_id\": \"5a02af461454aa15ea3fc090\",\n              \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n            },\n            {\n              \"userName\": \"admin\",\n              \"_id\": \"5a03d8e272bf56102f97ca73\",\n              \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n            }\n          ],\n          \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"滴滴答答滴滴答答的\",\n          \"_id\": \"5a027df61454aa15ea3fc08a\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n          \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n          \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n          \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n          \"_id\": \"5a03da8772bf56102f97ca75\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"dwdwdw\",\n          \"_id\": \"5a051ec1d89b7f51860b0c24\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n        }\n      ],\n      \"replyNum\": 7,\n      \"viewed\": 273,\n      \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n    },\n    {\n      \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n      \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n      \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [\n        {\n          \"userName\": \"admin\",\n          \"content\": \"好，测试测试\",\n          \"_id\": \"5a018409ec9e0358be71b6b6\",\n          \"replyChildList\": [\n            {\n              \"userName\": \"admin\",\n              \"content\": \"cedcece\",\n              \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n              \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n            },\n            {\n              \"userName\": \"admin\",\n              \"content\": \"vfvfvfvf\",\n              \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n              \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n            }\n          ],\n          \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"dwdwdwdw\",\n          \"_id\": \"5a02b1d11454aa15ea3fc093\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n          \"_id\": \"5a0426df36119115add2f7fe\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n        }\n      ],\n      \"replyNum\": 0,\n      \"viewed\": 53,\n      \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n    },\n    {\n      \"_id\": \"5a02afed1454aa15ea3fc092\",\n      \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n      \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 5,\n      \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n    },\n    {\n      \"_id\": \"5a04050d36119115add2f7fb\",\n      \"title\": \"6\",\n      \"content\": \"6\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 0,\n      \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n    },\n    {\n      \"_id\": \"5a04051036119115add2f7fc\",\n      \"title\": \"7\",\n      \"content\": \"7\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 1,\n      \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n    },\n    {\n      \"_id\": \"5a04051a36119115add2f7fd\",\n      \"title\": \"8\",\n      \"content\": \"8\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 0,\n      \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n    },\n    {\n      \"_id\": \"5a0506db1ec94d036d812378\",\n      \"title\": \"swdwd\",\n      \"content\": \"wdqdqds\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 0,\n      \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n    },\n    {\n      \"_id\": \"5a050d461ec94d036d812379\",\n      \"title\": \"123323\",\n      \"content\": \"123132323\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n          \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n          \"_id\": \"5a096bfd391f055b03517241\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n        }\n      ],\n      \"replyNum\": 2,\n      \"viewed\": 10,\n      \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:20:04.217] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"admin","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 9
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 273,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:20:09.301] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 7
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 273,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:20:18.803] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=admin
request client ip:  ::1
request query:  {"userName":"admin"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:20:18.803Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:20:18.809] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"admin"}
response time: 7
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n      \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n      \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [\n        {\n          \"userName\": \"admin\",\n          \"content\": \"Mark\\n\",\n          \"_id\": \"5a027dec1454aa15ea3fc089\",\n          \"replyChildList\": [\n            {\n              \"userName\": \"admin\",\n              \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n              \"_id\": \"5a02af461454aa15ea3fc090\",\n              \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n            },\n            {\n              \"userName\": \"admin\",\n              \"_id\": \"5a03d8e272bf56102f97ca73\",\n              \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n            }\n          ],\n          \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"滴滴答答滴滴答答的\",\n          \"_id\": \"5a027df61454aa15ea3fc08a\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n          \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n          \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n          \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n          \"_id\": \"5a03da8772bf56102f97ca75\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"dwdwdw\",\n          \"_id\": \"5a051ec1d89b7f51860b0c24\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n        }\n      ],\n      \"replyNum\": 7,\n      \"viewed\": 273,\n      \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n    },\n    {\n      \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n      \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n      \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [\n        {\n          \"userName\": \"admin\",\n          \"content\": \"好，测试测试\",\n          \"_id\": \"5a018409ec9e0358be71b6b6\",\n          \"replyChildList\": [\n            {\n              \"userName\": \"admin\",\n              \"content\": \"cedcece\",\n              \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n              \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n            },\n            {\n              \"userName\": \"admin\",\n              \"content\": \"vfvfvfvf\",\n              \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n              \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n            }\n          ],\n          \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"dwdwdwdw\",\n          \"_id\": \"5a02b1d11454aa15ea3fc093\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n          \"_id\": \"5a0426df36119115add2f7fe\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n        }\n      ],\n      \"replyNum\": 0,\n      \"viewed\": 53,\n      \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n    },\n    {\n      \"_id\": \"5a02afed1454aa15ea3fc092\",\n      \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n      \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 5,\n      \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n    },\n    {\n      \"_id\": \"5a04050d36119115add2f7fb\",\n      \"title\": \"6\",\n      \"content\": \"6\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 0,\n      \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n    },\n    {\n      \"_id\": \"5a04051036119115add2f7fc\",\n      \"title\": \"7\",\n      \"content\": \"7\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 1,\n      \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n    },\n    {\n      \"_id\": \"5a04051a36119115add2f7fd\",\n      \"title\": \"8\",\n      \"content\": \"8\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 0,\n      \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n    },\n    {\n      \"_id\": \"5a0506db1ec94d036d812378\",\n      \"title\": \"swdwd\",\n      \"content\": \"wdqdqds\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 0,\n      \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n    },\n    {\n      \"_id\": \"5a050d461ec94d036d812379\",\n      \"title\": \"123323\",\n      \"content\": \"123132323\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n          \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n          \"_id\": \"5a096bfd391f055b03517241\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n        }\n      ],\n      \"replyNum\": 2,\n      \"viewed\": 10,\n      \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:20:18.819] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"admin","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 7
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 273,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:20:28.413] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 273,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:20:36.071] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 7
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 273,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:20:56.286] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 273,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:20:58.493] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 273,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:21:17.180] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 273,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:21:19.927] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 8
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 273,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:21:21.999] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 273,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:21:38.074] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 7
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 273,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:21:40.368] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 273,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:22:08.334] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 273,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:22:10.402] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/updateCheckTimes
request client ip:  ::1
request body: 
{"id":"5a0183c8ec9e0358be71b6b4","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n    \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n    \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"Mark\\n\",\n        \"_id\": \"5a027dec1454aa15ea3fc089\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02af461454aa15ea3fc090\",\n            \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"_id\": \"5a03d8e272bf56102f97ca73\",\n            \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"滴滴答答滴滴答答的\",\n        \"_id\": \"5a027df61454aa15ea3fc08a\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n        \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n        \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n        \"_id\": \"5a03da8772bf56102f97ca75\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdw\",\n        \"_id\": \"5a051ec1d89b7f51860b0c24\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n      }\n    ],\n    \"replyNum\": 7,\n    \"viewed\": 274,\n    \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:22:10.404] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/art/getArticleDetail?id=5a0183c8ec9e0358be71b6b4
request client ip:  ::1
request query:  {"id":"5a0183c8ec9e0358be71b6b4"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n    \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n    \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"Mark\\n\",\n        \"_id\": \"5a027dec1454aa15ea3fc089\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02af461454aa15ea3fc090\",\n            \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"_id\": \"5a03d8e272bf56102f97ca73\",\n            \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"滴滴答答滴滴答答的\",\n        \"_id\": \"5a027df61454aa15ea3fc08a\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n        \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n        \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n        \"_id\": \"5a03da8772bf56102f97ca75\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdw\",\n        \"_id\": \"5a051ec1d89b7f51860b0c24\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n      }\n    ],\n    \"replyNum\": 7,\n    \"viewed\": 274,\n    \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:22:10.554] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /uploads/album/057c71634a756.jpg
request client ip:  ::1
request query:  {}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"error\"\n}"
*************** response log end ***************

[2017-11-17 10:22:10.554] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /uploads/album/369f24f883537.jpg
request client ip:  ::1
request query:  {}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"error\"\n}"
*************** response log end ***************

[2017-11-17 10:22:11.845] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=admin
request client ip:  ::1
request query:  {"userName":"admin"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:22:11.844Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:22:11.850] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"admin"}
response time: 7
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n      \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n      \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [\n        {\n          \"userName\": \"admin\",\n          \"content\": \"Mark\\n\",\n          \"_id\": \"5a027dec1454aa15ea3fc089\",\n          \"replyChildList\": [\n            {\n              \"userName\": \"admin\",\n              \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n              \"_id\": \"5a02af461454aa15ea3fc090\",\n              \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n            },\n            {\n              \"userName\": \"admin\",\n              \"_id\": \"5a03d8e272bf56102f97ca73\",\n              \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n            }\n          ],\n          \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"滴滴答答滴滴答答的\",\n          \"_id\": \"5a027df61454aa15ea3fc08a\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n          \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n          \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n          \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n          \"_id\": \"5a03da8772bf56102f97ca75\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"dwdwdw\",\n          \"_id\": \"5a051ec1d89b7f51860b0c24\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n        }\n      ],\n      \"replyNum\": 7,\n      \"viewed\": 274,\n      \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n    },\n    {\n      \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n      \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n      \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [\n        {\n          \"userName\": \"admin\",\n          \"content\": \"好，测试测试\",\n          \"_id\": \"5a018409ec9e0358be71b6b6\",\n          \"replyChildList\": [\n            {\n              \"userName\": \"admin\",\n              \"content\": \"cedcece\",\n              \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n              \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n            },\n            {\n              \"userName\": \"admin\",\n              \"content\": \"vfvfvfvf\",\n              \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n              \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n            }\n          ],\n          \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"dwdwdwdw\",\n          \"_id\": \"5a02b1d11454aa15ea3fc093\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n          \"_id\": \"5a0426df36119115add2f7fe\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n        }\n      ],\n      \"replyNum\": 0,\n      \"viewed\": 53,\n      \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n    },\n    {\n      \"_id\": \"5a02afed1454aa15ea3fc092\",\n      \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n      \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 5,\n      \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n    },\n    {\n      \"_id\": \"5a04050d36119115add2f7fb\",\n      \"title\": \"6\",\n      \"content\": \"6\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 0,\n      \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n    },\n    {\n      \"_id\": \"5a04051036119115add2f7fc\",\n      \"title\": \"7\",\n      \"content\": \"7\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 1,\n      \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n    },\n    {\n      \"_id\": \"5a04051a36119115add2f7fd\",\n      \"title\": \"8\",\n      \"content\": \"8\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 0,\n      \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n    },\n    {\n      \"_id\": \"5a0506db1ec94d036d812378\",\n      \"title\": \"swdwd\",\n      \"content\": \"wdqdqds\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 0,\n      \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n    },\n    {\n      \"_id\": \"5a050d461ec94d036d812379\",\n      \"title\": \"123323\",\n      \"content\": \"123132323\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n          \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n          \"_id\": \"5a096bfd391f055b03517241\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n        }\n      ],\n      \"replyNum\": 2,\n      \"viewed\": 10,\n      \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:22:11.859] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"admin","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 8
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 274,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:23:27.629] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 274,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 53,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:23:29.097] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/updateCheckTimes
request client ip:  ::1
request body: 
{"id":"5a0183f2ec9e0358be71b6b5","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 7
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n    \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n    \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"好，测试测试\",\n        \"_id\": \"5a018409ec9e0358be71b6b6\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"cedcece\",\n            \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n            \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"vfvfvfvf\",\n            \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n            \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdwdw\",\n        \"_id\": \"5a02b1d11454aa15ea3fc093\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n        \"_id\": \"5a0426df36119115add2f7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n      }\n    ],\n    \"replyNum\": 0,\n    \"viewed\": 54,\n    \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:23:29.118] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/art/getArticleDetail?id=5a0183f2ec9e0358be71b6b5
request client ip:  ::1
request query:  {"id":"5a0183f2ec9e0358be71b6b5"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n    \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n    \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"好，测试测试\",\n        \"_id\": \"5a018409ec9e0358be71b6b6\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"cedcece\",\n            \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n            \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"vfvfvfvf\",\n            \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n            \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdwdw\",\n        \"_id\": \"5a02b1d11454aa15ea3fc093\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n        \"_id\": \"5a0426df36119115add2f7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n      }\n    ],\n    \"replyNum\": 0,\n    \"viewed\": 54,\n    \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:23:33.333] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 7
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 274,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:23:40.017] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:23:40.017Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:23:40.019] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:23:40.030] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 9
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 274,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:23:46.592] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/updateCheckTimes
request client ip:  ::1
request body: 
{"id":"5a0183c8ec9e0358be71b6b4","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 9
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n    \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n    \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"Mark\\n\",\n        \"_id\": \"5a027dec1454aa15ea3fc089\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02af461454aa15ea3fc090\",\n            \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"_id\": \"5a03d8e272bf56102f97ca73\",\n            \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"滴滴答答滴滴答答的\",\n        \"_id\": \"5a027df61454aa15ea3fc08a\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n        \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n        \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n        \"_id\": \"5a03da8772bf56102f97ca75\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdw\",\n        \"_id\": \"5a051ec1d89b7f51860b0c24\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n      }\n    ],\n    \"replyNum\": 7,\n    \"viewed\": 275,\n    \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:23:46.594] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/art/getArticleDetail?id=5a0183c8ec9e0358be71b6b4
request client ip:  ::1
request query:  {"id":"5a0183c8ec9e0358be71b6b4"}
response time: 9
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n    \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n    \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"Mark\\n\",\n        \"_id\": \"5a027dec1454aa15ea3fc089\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02af461454aa15ea3fc090\",\n            \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"_id\": \"5a03d8e272bf56102f97ca73\",\n            \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"滴滴答答滴滴答答的\",\n        \"_id\": \"5a027df61454aa15ea3fc08a\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n        \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n        \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n        \"_id\": \"5a03da8772bf56102f97ca75\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdw\",\n        \"_id\": \"5a051ec1d89b7f51860b0c24\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n      }\n    ],\n    \"replyNum\": 7,\n    \"viewed\": 275,\n    \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:23:46.740] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /uploads/album/369f24f883537.jpg
request client ip:  ::1
request query:  {}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"error\"\n}"
*************** response log end ***************

[2017-11-17 10:23:46.740] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /uploads/album/057c71634a756.jpg
request client ip:  ::1
request query:  {}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"error\"\n}"
*************** response log end ***************

[2017-11-17 10:23:47.742] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 275,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:23:49.832] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:23:49.832Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:23:49.836] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:23:49.842] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 275,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:25:07.014] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:25:07.013Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:25:07.016] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:25:07.031] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 10
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 275,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:25:10.721] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:25:10.721Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:25:10.724] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:25:10.732] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 275,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:25:15.244] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:25:15.244Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:25:15.246] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:25:15.257] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 275,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:25:17.594] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:25:17.594Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:25:17.597] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:25:17.605] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 275,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:25:50.049] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:25:50.049Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:25:50.052] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:25:50.059] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 275,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:26:01.053] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:26:01.052Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:26:01.056] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:26:01.063] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 275,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:26:04.254] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:26:04.254Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:26:04.256] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:26:04.264] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 275,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:26:07.476] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:26:07.475Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:26:07.478] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:26:07.486] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 275,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:26:31.212] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:26:31.211Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:26:31.214] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:26:31.223] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 275,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:26:35.347] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:26:35.346Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:26:35.350] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:26:35.357] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 275,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:26:37.597] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:26:37.597Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:26:37.600] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:26:37.605] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 275,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:26:46.653] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:26:46.653Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:26:46.655] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:26:46.662] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":"qichangjun","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg0NDYzLCJleHAiOjE1MTA5Mjc2NjN9.1kDHNiPBkWofvKHd-9AW42TeqJ2CvhKRwVdseth8rSA"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 275,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:26:54.660] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/users/login
request client ip:  ::1
request body: 
{"userName":"admin","password":"123abc"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"密码不正确\",\n  \"data\": null\n}"
*************** response log end ***************

[2017-11-17 10:26:58.471] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/users/login
request client ip:  ::1
request body: 
{"userName":"admin","password":"334204642"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"密码不正确\",\n  \"data\": null\n}"
*************** response log end ***************

[2017-11-17 10:27:02.246] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/users/login
request client ip:  ::1
request body: 
{"userName":"admin","password":"abc334204642"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"密码不正确\",\n  \"data\": null\n}"
*************** response log end ***************

[2017-11-17 10:27:05.934] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/users/login
request client ip:  ::1
request body: 
{"userName":"qicj","password":"123abc"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"用户不存在\",\n  \"data\": null\n}"
*************** response log end ***************

[2017-11-17 10:27:16.705] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/users/registerUser
request client ip:  ::1
request body: 
{"userName":"qicj","password":"123abc","email":"123@qq.com","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoicWljaiIsImlhdCI6MTUxMDg4NTYzNiwiZXhwIjoxNTEwOTI4ODM2fQ.RJl6_N8tOVO4oDpVkFgHg-_GqwOSXkCY_xzO8jfPAW0"}
response time: 60
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"注册成功\",\n  \"data\": null\n}"
*************** response log end ***************

[2017-11-17 10:27:19.183] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/users/login
request client ip:  ::1
request body: 
{"userName":"qicj","password":"123abc"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"success\",\n  \"data\": {\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNWEwZTQ5MDRmODhmNTQyMDNhYjQwMmNmIiwiaWF0IjoxNTEwODg1NjM5LCJleHAiOjE1MTA5Mjg4Mzl9.foebY4xWLQW6ym8o_aFeqTf23NIubPMxhIEx5mXgLhM\",\n    \"userName\": \"qicj\",\n    \"role\": \"normal\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:27:19.209] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNWEwZTQ5MDRmODhmNTQyMDNhYjQwMmNmIiwiaWF0IjoxNTEwODg1NjM5LCJleHAiOjE1MTA5Mjg4Mzl9.foebY4xWLQW6ym8o_aFeqTf23NIubPMxhIEx5mXgLhM"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 275,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:27:23.759] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=admin
request client ip:  ::1
request query:  {"userName":"admin"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:27:23.758Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:27:23.764] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"admin"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n      \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n      \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [\n        {\n          \"userName\": \"admin\",\n          \"content\": \"Mark\\n\",\n          \"_id\": \"5a027dec1454aa15ea3fc089\",\n          \"replyChildList\": [\n            {\n              \"userName\": \"admin\",\n              \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n              \"_id\": \"5a02af461454aa15ea3fc090\",\n              \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n            },\n            {\n              \"userName\": \"admin\",\n              \"_id\": \"5a03d8e272bf56102f97ca73\",\n              \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n            }\n          ],\n          \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"滴滴答答滴滴答答的\",\n          \"_id\": \"5a027df61454aa15ea3fc08a\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n          \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n          \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n          \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n          \"_id\": \"5a03da8772bf56102f97ca75\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"dwdwdw\",\n          \"_id\": \"5a051ec1d89b7f51860b0c24\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n        }\n      ],\n      \"replyNum\": 7,\n      \"viewed\": 275,\n      \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n    },\n    {\n      \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n      \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n      \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [\n        {\n          \"userName\": \"admin\",\n          \"content\": \"好，测试测试\",\n          \"_id\": \"5a018409ec9e0358be71b6b6\",\n          \"replyChildList\": [\n            {\n              \"userName\": \"admin\",\n              \"content\": \"cedcece\",\n              \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n              \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n            },\n            {\n              \"userName\": \"admin\",\n              \"content\": \"vfvfvfvf\",\n              \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n              \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n            }\n          ],\n          \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"dwdwdwdw\",\n          \"_id\": \"5a02b1d11454aa15ea3fc093\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n          \"_id\": \"5a0426df36119115add2f7fe\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n        }\n      ],\n      \"replyNum\": 0,\n      \"viewed\": 54,\n      \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n    },\n    {\n      \"_id\": \"5a02afed1454aa15ea3fc092\",\n      \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n      \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 5,\n      \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n    },\n    {\n      \"_id\": \"5a04050d36119115add2f7fb\",\n      \"title\": \"6\",\n      \"content\": \"6\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 0,\n      \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n    },\n    {\n      \"_id\": \"5a04051036119115add2f7fc\",\n      \"title\": \"7\",\n      \"content\": \"7\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 1,\n      \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n    },\n    {\n      \"_id\": \"5a04051a36119115add2f7fd\",\n      \"title\": \"8\",\n      \"content\": \"8\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 0,\n      \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n    },\n    {\n      \"_id\": \"5a0506db1ec94d036d812378\",\n      \"title\": \"swdwd\",\n      \"content\": \"wdqdqds\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 0,\n      \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n    },\n    {\n      \"_id\": \"5a050d461ec94d036d812379\",\n      \"title\": \"123323\",\n      \"content\": \"123132323\",\n      \"author\": \"admin\",\n      \"__v\": 0,\n      \"replyList\": [\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n          \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n        },\n        {\n          \"userName\": \"admin\",\n          \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n          \"_id\": \"5a096bfd391f055b03517241\",\n          \"replyChildList\": [],\n          \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n        }\n      ],\n      \"replyNum\": 2,\n      \"viewed\": 10,\n      \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:27:25.340] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNWEwZTQ5MDRmODhmNTQyMDNhYjQwMmNmIiwiaWF0IjoxNTEwODg1NjM5LCJleHAiOjE1MTA5Mjg4Mzl9.foebY4xWLQW6ym8o_aFeqTf23NIubPMxhIEx5mXgLhM"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 275,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:27:26.338] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/updateCheckTimes
request client ip:  ::1
request body: 
{"id":"5a0183c8ec9e0358be71b6b4","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNWEwZTQ5MDRmODhmNTQyMDNhYjQwMmNmIiwiaWF0IjoxNTEwODg1NjM5LCJleHAiOjE1MTA5Mjg4Mzl9.foebY4xWLQW6ym8o_aFeqTf23NIubPMxhIEx5mXgLhM"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n    \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n    \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"Mark\\n\",\n        \"_id\": \"5a027dec1454aa15ea3fc089\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02af461454aa15ea3fc090\",\n            \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"_id\": \"5a03d8e272bf56102f97ca73\",\n            \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"滴滴答答滴滴答答的\",\n        \"_id\": \"5a027df61454aa15ea3fc08a\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n        \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n        \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n        \"_id\": \"5a03da8772bf56102f97ca75\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdw\",\n        \"_id\": \"5a051ec1d89b7f51860b0c24\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n      }\n    ],\n    \"replyNum\": 7,\n    \"viewed\": 276,\n    \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:27:26.340] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/art/getArticleDetail?id=5a0183c8ec9e0358be71b6b4
request client ip:  ::1
request query:  {"id":"5a0183c8ec9e0358be71b6b4"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n    \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n    \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"Mark\\n\",\n        \"_id\": \"5a027dec1454aa15ea3fc089\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02af461454aa15ea3fc090\",\n            \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"_id\": \"5a03d8e272bf56102f97ca73\",\n            \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"滴滴答答滴滴答答的\",\n        \"_id\": \"5a027df61454aa15ea3fc08a\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n        \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n        \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n        \"_id\": \"5a03da8772bf56102f97ca75\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdw\",\n        \"_id\": \"5a051ec1d89b7f51860b0c24\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n      }\n    ],\n    \"replyNum\": 7,\n    \"viewed\": 276,\n    \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:27:26.511] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /uploads/album/057c71634a756.jpg
request client ip:  ::1
request query:  {}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"error\"\n}"
*************** response log end ***************

[2017-11-17 10:27:26.512] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /uploads/album/369f24f883537.jpg
request client ip:  ::1
request query:  {}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"error\"\n}"
*************** response log end ***************

[2017-11-17 10:27:27.978] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNWEwZTQ5MDRmODhmNTQyMDNhYjQwMmNmIiwiaWF0IjoxNTEwODg1NjM5LCJleHAiOjE1MTA5Mjg4Mzl9.foebY4xWLQW6ym8o_aFeqTf23NIubPMxhIEx5mXgLhM"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 12,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:27:29.022] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:27:29.022Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:27:29.025] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 12,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:27:32.297] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/updateCheckTimes
request client ip:  ::1
request body: 
{"id":"5a0273281454aa15ea3fc088","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNWEwZTQ5MDRmODhmNTQyMDNhYjQwMmNmIiwiaWF0IjoxNTEwODg1NjM5LCJleHAiOjE1MTA5Mjg4Mzl9.foebY4xWLQW6ym8o_aFeqTf23NIubPMxhIEx5mXgLhM"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0273281454aa15ea3fc088\",\n    \"title\": \"Promise 必知必会（十道题）\",\n    \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n    \"author\": \"qichangjun\",\n    \"__v\": 0,\n    \"replyList\": [],\n    \"replyNum\": 0,\n    \"viewed\": 13,\n    \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:27:32.330] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/art/getArticleDetail?id=5a0273281454aa15ea3fc088
request client ip:  ::1
request query:  {"id":"5a0273281454aa15ea3fc088"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0273281454aa15ea3fc088\",\n    \"title\": \"Promise 必知必会（十道题）\",\n    \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n    \"author\": \"qichangjun\",\n    \"__v\": 0,\n    \"replyList\": [],\n    \"replyNum\": 0,\n    \"viewed\": 13,\n    \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:27:33.656] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNWEwZTQ5MDRmODhmNTQyMDNhYjQwMmNmIiwiaWF0IjoxNTEwODg1NjM5LCJleHAiOjE1MTA5Mjg4Mzl9.foebY4xWLQW6ym8o_aFeqTf23NIubPMxhIEx5mXgLhM"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:27:34.151] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qicj
request client ip:  ::1
request query:  {"userName":"qicj"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qicj\",\n    \"email\": \"123@qq.com\",\n    \"registerTime\": \"2017-11-17T02:27:16.652Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:27:34.152] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qicj"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": []\n}"
*************** response log end ***************

[2017-11-17 10:27:36.521] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNWEwZTQ5MDRmODhmNTQyMDNhYjQwMmNmIiwiaWF0IjoxNTEwODg1NjM5LCJleHAiOjE1MTA5Mjg4Mzl9.foebY4xWLQW6ym8o_aFeqTf23NIubPMxhIEx5mXgLhM"}
response time: 7
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:27:42.349] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/users/login
request client ip:  ::1
request body: 
{"userName":"qichangjun","password":"123abc"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"success\",\n  \"data\": {\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg1NjYyLCJleHAiOjE1MTA5Mjg4NjJ9.XgfxAJSeSA6K_xfKdXO6KvPMVlJDPLDjCzvV9FnCDRc\",\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:27:42.374] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg1NjYyLCJleHAiOjE1MTA5Mjg4NjJ9.XgfxAJSeSA6K_xfKdXO6KvPMVlJDPLDjCzvV9FnCDRc"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:28:18.544] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg1NjYyLCJleHAiOjE1MTA5Mjg4NjJ9.XgfxAJSeSA6K_xfKdXO6KvPMVlJDPLDjCzvV9FnCDRc"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:32:49.224] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg1NjYyLCJleHAiOjE1MTA5Mjg4NjJ9.XgfxAJSeSA6K_xfKdXO6KvPMVlJDPLDjCzvV9FnCDRc"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:39:42.498] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg1NjYyLCJleHAiOjE1MTA5Mjg4NjJ9.XgfxAJSeSA6K_xfKdXO6KvPMVlJDPLDjCzvV9FnCDRc"}
response time: 7
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:39:48.373] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg1NjYyLCJleHAiOjE1MTA5Mjg4NjJ9.XgfxAJSeSA6K_xfKdXO6KvPMVlJDPLDjCzvV9FnCDRc"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:39:52.275] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg1NjYyLCJleHAiOjE1MTA5Mjg4NjJ9.XgfxAJSeSA6K_xfKdXO6KvPMVlJDPLDjCzvV9FnCDRc"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:43:19.880] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/users/login
request client ip:  ::1
request body: 
{"userName":"qichangjun","password":"12345"}
response time: 1
response status: 200
response body: 
"{\n  \"code\": 0,\n  \"message\": \"密码不正确\",\n  \"data\": null\n}"
*************** response log end ***************

[2017-11-17 10:43:22.748] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/users/login
request client ip:  ::1
request body: 
{"userName":"qichangjun","password":"123abc"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"success\",\n  \"data\": {\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg2NjAyLCJleHAiOjE1MTA5Mjk4MDJ9.6wALHhw3KSKvjNTFplS99mlbAWXQN3YBnZkqrHaep5g\",\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:43:23.050] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg2NjAyLCJleHAiOjE1MTA5Mjk4MDJ9.6wALHhw3KSKvjNTFplS99mlbAWXQN3YBnZkqrHaep5g"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:43:24.609] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":null,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg2NjAyLCJleHAiOjE1MTA5Mjk4MDJ9.6wALHhw3KSKvjNTFplS99mlbAWXQN3YBnZkqrHaep5g"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:43:42.379] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":null,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg2NjAyLCJleHAiOjE1MTA5Mjk4MDJ9.6wALHhw3KSKvjNTFplS99mlbAWXQN3YBnZkqrHaep5g"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:43:44.365] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":null,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg2NjAyLCJleHAiOjE1MTA5Mjk4MDJ9.6wALHhw3KSKvjNTFplS99mlbAWXQN3YBnZkqrHaep5g"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:43:54.485] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":null,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg2NjAyLCJleHAiOjE1MTA5Mjk4MDJ9.6wALHhw3KSKvjNTFplS99mlbAWXQN3YBnZkqrHaep5g"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:43:59.402] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":null,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg2NjAyLCJleHAiOjE1MTA5Mjk4MDJ9.6wALHhw3KSKvjNTFplS99mlbAWXQN3YBnZkqrHaep5g"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04050d36119115add2f7fb\",\n        \"title\": \"6\",\n        \"content\": \"6\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 9\n  }\n}"
*************** response log end ***************

[2017-11-17 10:44:05.196] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/deleteArticle
request client ip:  ::1
request body: 
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg2NjAyLCJleHAiOjE1MTA5Mjk4MDJ9.6wALHhw3KSKvjNTFplS99mlbAWXQN3YBnZkqrHaep5g","id":"5a04050d36119115add2f7fb"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a04050d36119115add2f7fb\",\n    \"title\": \"6\",\n    \"content\": \"6\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [],\n    \"replyNum\": 0,\n    \"viewed\": 0,\n    \"creatDate\": \"2017-11-09T07:34:37.560Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:44:05.645] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":9,"userName":null,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg2NjAyLCJleHAiOjE1MTA5Mjk4MDJ9.6wALHhw3KSKvjNTFplS99mlbAWXQN3YBnZkqrHaep5g"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 8\n  }\n}"
*************** response log end ***************

[2017-11-17 10:44:58.683] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":null,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg2NjAyLCJleHAiOjE1MTA5Mjk4MDJ9.6wALHhw3KSKvjNTFplS99mlbAWXQN3YBnZkqrHaep5g"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 8\n  }\n}"
*************** response log end ***************

[2017-11-17 10:45:30.459] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:45:30.459Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:45:30.465] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 13,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:45:34.246] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:45:34.246Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:45:34.248] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 13,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:45:48.316] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:45:48.316Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:45:48.318] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 3
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 13,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:45:52.188] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":null,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg2NjAyLCJleHAiOjE1MTA5Mjk4MDJ9.6wALHhw3KSKvjNTFplS99mlbAWXQN3YBnZkqrHaep5g"}
response time: 6
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 54,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 8\n  }\n}"
*************** response log end ***************

[2017-11-17 10:45:53.439] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/updateCheckTimes
request client ip:  ::1
request body: 
{"id":"5a0183f2ec9e0358be71b6b5","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg2NjAyLCJleHAiOjE1MTA5Mjk4MDJ9.6wALHhw3KSKvjNTFplS99mlbAWXQN3YBnZkqrHaep5g"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n    \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n    \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"好，测试测试\",\n        \"_id\": \"5a018409ec9e0358be71b6b6\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"cedcece\",\n            \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n            \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"vfvfvfvf\",\n            \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n            \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdwdw\",\n        \"_id\": \"5a02b1d11454aa15ea3fc093\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n        \"_id\": \"5a0426df36119115add2f7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n      }\n    ],\n    \"replyNum\": 0,\n    \"viewed\": 55,\n    \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:45:53.442] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/art/getArticleDetail?id=5a0183f2ec9e0358be71b6b5
request client ip:  ::1
request query:  {"id":"5a0183f2ec9e0358be71b6b5"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n    \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n    \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n    \"author\": \"admin\",\n    \"__v\": 0,\n    \"replyList\": [\n      {\n        \"userName\": \"admin\",\n        \"content\": \"好，测试测试\",\n        \"_id\": \"5a018409ec9e0358be71b6b6\",\n        \"replyChildList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"cedcece\",\n            \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n            \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"vfvfvfvf\",\n            \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n            \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n          }\n        ],\n        \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"dwdwdwdw\",\n        \"_id\": \"5a02b1d11454aa15ea3fc093\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n      },\n      {\n        \"userName\": \"admin\",\n        \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n        \"_id\": \"5a0426df36119115add2f7fe\",\n        \"replyChildList\": [],\n        \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n      }\n    ],\n    \"replyNum\": 0,\n    \"viewed\": 55,\n    \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:45:54.560] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":null,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg2NjAyLCJleHAiOjE1MTA5Mjk4MDJ9.6wALHhw3KSKvjNTFplS99mlbAWXQN3YBnZkqrHaep5g"}
response time: 4
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 55,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 8\n  }\n}"
*************** response log end ***************

[2017-11-17 10:46:31.705] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg2NjAyLCJleHAiOjE1MTA5Mjk4MDJ9.6wALHhw3KSKvjNTFplS99mlbAWXQN3YBnZkqrHaep5g"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 55,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 8\n  }\n}"
*************** response log end ***************

[2017-11-17 10:46:32.934] [INFO] resLogger - 
*************** response log start ***************
request method: GET
request originalUrl:  /api/users/getUserInfo?userName=qichangjun
request client ip:  ::1
request query:  {"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"回复成功\",\n  \"data\": {\n    \"userName\": \"qichangjun\",\n    \"role\": \"admin\",\n    \"registerTime\": \"2017-11-17T02:46:32.933Z\"\n  }\n}"
*************** response log end ***************

[2017-11-17 10:46:32.937] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getOwnarticleLists
request client ip:  ::1
request body: 
{"userName":"qichangjun"}
response time: 2
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": [\n    {\n      \"_id\": \"5a0273281454aa15ea3fc088\",\n      \"title\": \"Promise 必知必会（十道题）\",\n      \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n      \"author\": \"qichangjun\",\n      \"__v\": 0,\n      \"replyList\": [],\n      \"replyNum\": 0,\n      \"viewed\": 13,\n      \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n    }\n  ]\n}"
*************** response log end ***************

[2017-11-17 10:46:34.462] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg2NjAyLCJleHAiOjE1MTA5Mjk4MDJ9.6wALHhw3KSKvjNTFplS99mlbAWXQN3YBnZkqrHaep5g"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 55,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 8\n  }\n}"
*************** response log end ***************

[2017-11-17 10:46:35.807] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"userName":null,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg2NjAyLCJleHAiOjE1MTA5Mjk4MDJ9.6wALHhw3KSKvjNTFplS99mlbAWXQN3YBnZkqrHaep5g"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 55,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 8\n  }\n}"
*************** response log end ***************

[2017-11-17 10:47:33.363] [INFO] resLogger - 
*************** response log start ***************
request method: POST
request originalUrl:  /api/art/getArticleLists
request client ip:  ::1
request body: 
{"currentPage":1,"pageSize":10,"sortField":"lastReplyTime","totalElement":1,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNTlmYmUwZjVjZTg4MDkwN2MyMGI1OWNlIiwiaWF0IjoxNTEwODg2NjAyLCJleHAiOjE1MTA5Mjk4MDJ9.6wALHhw3KSKvjNTFplS99mlbAWXQN3YBnZkqrHaep5g"}
response time: 5
response status: 200
response body: 
"{\n  \"code\": 1,\n  \"message\": \"操作成功\",\n  \"data\": {\n    \"data\": [\n      {\n        \"_id\": \"5a0183c8ec9e0358be71b6b4\",\n        \"title\": \"JS基础题，却有多少人能弄清楚其中的奥义？\",\n        \"content\": \"let data = [1,2,3], i = 0;\\ndata[i++] = data[i++]*2;\\n问这个操作之后，data数组为多少？i的值是多少？(各1分) 为什么？(98分)\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"Mark\\n\",\n            \"_id\": \"5a027dec1454aa15ea3fc089\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n                \"_id\": \"5a02af461454aa15ea3fc090\",\n                \"replyTime\": \"2017-11-08T07:16:22.477Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"_id\": \"5a03d8e272bf56102f97ca73\",\n                \"replyTime\": \"2017-11-09T04:26:10.065Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-08T03:45:48.109Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"滴滴答答滴滴答答的\",\n            \"_id\": \"5a027df61454aa15ea3fc08a\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T03:45:58.274Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n            \"_id\": \"5a02aedc1454aa15ea3fc08f\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:14:36.506Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![057c71634a756.jpg](http://localhost:3001/uploads/album/057c71634a756.jpg) \\n\\n\",\n            \"_id\": \"5a03ce9e15d1c50d0c4ab7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:42:22.576Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![369f24f883537.jpg](http://localhost:3001/uploads/album/369f24f883537.jpg)\",\n            \"_id\": \"5a03d0f9b159ac0f3bfa9129\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T03:52:25.838Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![1a0ead81fdaa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/1a0ead81fdaa.jpg)\\nnh\\n\\n    console.log(12345)\",\n            \"_id\": \"5a03da8772bf56102f97ca75\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T04:33:11.672Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdw\",\n            \"_id\": \"5a051ec1d89b7f51860b0c24\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T03:36:33.097Z\"\n          }\n        ],\n        \"replyNum\": 7,\n        \"viewed\": 276,\n        \"creatDate\": \"2017-11-07T09:58:32.465Z\"\n      },\n      {\n        \"_id\": \"5a0183f2ec9e0358be71b6b5\",\n        \"title\": \"node源码粗读(1)：一个简单的nodejs文件从运行到结束都发生了什么\",\n        \"content\": \"os环境：macOS 10.12.5 ，ide:cLion，node版本：v8.0.0\\n\\n一、配置ide和node编译\\n\\n对ide的配置和node编译的过程这里不赘述了，如果有时间，可能写一篇blog简单介绍一下。\\n\\n二、node运行入口粗读\\n\\nnode入口集中在文件 node/src/node_main.cc中，让我们在node::Start这里搭一个断点，看看接下来都会发生什么。\\nissue5\\n\\n1. argc和argv\\n\\n这两个在之后的代码里会经常见到，argc表示的是命令行参数个数，而argv表示的是命令行的参数，如果没有参数那么就是node的运行的绝对地址\\n\\n2.platformInit运行\\n\\nnode运行的时候首先要走的便是platformInit方法，这个方法主要是对运行平台的一些参数进行初始化：\\nissue5\\n可以看到：首先有对信号的处理（sig*），还有对系统的stdin、stdout的检测（STDIN_FILENO，STDERR_FILENO），这里截图没截全，就不一一介绍了。\\n\\n3.调用node::performance::performance_node_start\\n\\n这里从字面就很好理解，开始对node性能进行记录，这里面有个要注意的地方是：它底层其实调用的是uv__hrtime。node有很多可以计算时间的方法，大家如果读读源码，就会发现，所有计算耗时的方法都绕不开这个api。\\n\\n4.调用uv_setup_args\\n\\n对uv_setup_args调用主要要解决的问题就是调用uv_malloc对argv的副本new_argv分配内存，并返回。说白了就是复制一份argv给process.title这个api用。\\n\\n5.调用Init方法\\n\\nInit(&argc, const_cast<const char**>(argv), &exec_argc, &exec_argv);\\n大家可以看到这个Init有四个参数，argc和argv刚才已经介绍过了，而后面两个参数分别给argc和argv加上了exec前缀，经过阅读就会发现，exec前缀就是待执行状态的argc和argv。在Init函数体内，主要做的事情有以下几个：\\n\\n开始计算node程序运行时间\\nprog_start_time = static_cast<double>(uv_now(uv_default_loop()));\\n通过调用uv_loop_configure，对libuv信号进行确认，包括：uv_loop_block_signal等\\n通过node::SafeGetenv 读取node环境相关的argv来建立node环境相关配置参数的链接，例如：\\nSafeGetenv(\\\"OPENSSL_CONF\\\", &openssl_config);\\nnode建立起openSSL_CONF，而这个CONF来自你的参数–openssl-config\\n\\n通过node::ProcessArgv读取node参数相关的并进行分配内存处理，例如 --version，–trace-warnings等\\n6.判断openSSL\\n\\n#if HAVE_OPENSSL\\n  {\\n    std::string extra_ca_certs;\\n    if (SafeGetenv(\\\"NODE_EXTRA_CA_CERTS\\\", &extra_ca_certs))\\n      crypto::UseExtraCaCerts(extra_ca_certs);\\n  }\\n这里没什么好说的，就是判断openSSL，如果有的话读取ca，为用openSSL通讯做准备。\\n\\n7. v8_platform.Initialize初始化\\n\\nv8_platform.Initialize，这里主要对libuv线程池做初始化操作。\\n\\n8.V8::Initialize()初始化\\n\\n接线来就是重头戏了，对v8进行初始化操作，其中又囊括了很多点，我在下面一一列出，里面一些概念也会在列出的时候提及一下：\\n\\n首先会调用CallOnce(OnceType* once, void (*init_func)())，它会通过原子操作的方法（Acquire_Load）来确认是否已经调用过，如果没有调用过则进入到CallOnceImpl并最终调用 init_func，这个函数只有在初始化的时候进行调用：\\n// @files ./deps/v8/src/base/once.h line 83\\ninline void CallOnce(OnceType* once, NoArgFunction init_func) {\\n  if (Acquire_Load(once) != ONCE_STATE_DONE) {\\n    CallOnceImpl(once, reinterpret_cast<PointerArgFunction>(init_func), NULL);\\n  }\\n}\\n在这里有一个比较重要的概念，就是OnceType，这是node作者定义的一种类型，如果翻一下源码可以翻到一个宏定义 V8_DECLARE_ONCE，这是专门用来声明OnceType类型的，对于只需要在创建的时候声明一次的都会定义为OnceType,通过全局搜索就很容易找出来OnceType:\\nissue5\\n\\nCallOnceImpl对v8进行初始化的时候需要调用如下api： issue5 v8::internal::V8::InitializeOncePerProcessImpl，这个函数通过名字就能很好理解，就是只在进程运行时候初始化一次的接口，也就是上述的OnceType，咱们接着往下看。\\n这个api里面首先调用的是base::OS::Initialize这个api，这里不做过多解释，就是对操作系统相关的东西做兼容初始化操作\\n接下来比较重要的api就是Isolate::InitializeOncePerProcess() 这个了，这是对v8运行环境isolate进行初始化的地方（并没有调用生成isolate，只是告诉程序在进程运行的时候需要对isolate做的一系列操作），里面主要做的操作有：初始化isolate锁；初始化线程、线程数据块、数据表地址。\\nsampler::Sampler::SetUp()，采样器在这里就不做过多分析了，就是创建一个线程采集v8的状态。\\n在init_func调用结束后会调用一下c++中的原子操作方法Release_Store（应该是针对于内存屏障进行原子写操作的一个api），将数据装到内存中指定位置：\\ninline void Release_Store(volatile Atomic64* ptr, Atomic64 value) {\\n  __atomic_store_n(ptr, value, __ATOMIC_RELEASE);\\n}\\n9.调用node::performance::performance_v8_start\\n\\nnode::performance::performance_v8_start = PERFORMANCE_NOW();\\n这似曾相识的代码就不过多解释了，就是对v8进行性能记录，底层同样调用的uv_hrtime。\\n\\n10.调用内联Start\\n\\nissue5\\n环境搞定了，接下来就是开始运行咯。下面我们来看看这个start都做了哪些事情\\n\\n看到它第一个参数，就知道了，先初始化uv_default_loop，就不再过多解释了，有问题的可以翻翻libuv，很好理解，下面贴一下初始化的代码：\\n\\nuv_loop_t* uv_default_loop(void) {\\n  if (default_loop_ptr != NULL)\\n    return default_loop_ptr;\\n  if (uv_loop_init(&default_loop_struct))\\n    return NULL;\\n  default_loop_ptr = &default_loop_struct;\\n  return default_loop_ptr;\\n}\\n接下来是真正的start了，在这里贴一下代码，然后详细解释一下：\\n\\n Isolate::CreateParams params;\\n  ArrayBufferAllocator allocator;\\n  params.array_buffer_allocator = &allocator;\\n#ifdef NODE_ENABLE_VTUNE_PROFILING\\n  params.code_event_handler = vTune::GetVtuneCodeEventHandler();\\n#endif\\n\\n  Isolate* const isolate = Isolate::New(params);\\n  if (isolate == nullptr)\\n    return 12;  // Signal internal error.\\n\\n  isolate->AddMessageListener(OnMessage);\\n  isolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n  isolate->SetAutorunMicrotasks(false);\\n  isolate->SetFatalErrorHandler(OnFatalError);\\n第一行应该比较好理解，就是在isolate中创建参数，下面是params的列表： issue5\\nArrayBufferAllocator allocator这里是一个很重要的知识点，之前在Init的时候忘了提及了，node中buffer不会占用v8内存，而是开辟出的独立空间，这里就是声明之前Init时候封装好的ArrayBufferAllocator\\n解释一下这句代码：\\n isolate->AddMessageListener(OnMessage);\\n这句话表面上是给isolate添加监听，而如果你深入去研究的话就会发现，它是通过HandleScope来监听javascript对象内存的变化并发出相应的message。\\n\\n又是感觉似曾相识的代码，是不是经常在node中看到UncaughtException这几个字母，O(∩_∩)O\\nisolate->SetAbortOnUncaughtExceptionCallback(ShouldAbortOnUncaughtException);\\n这里要做的是对未捕获的异常进行监听（可能对libuv中的问题进行了监听，具体没有深入看，之后会进行确认）。\\n\\nisolate->SetAutorunMicrotasks(false); 这个我就不做过多解释了，microtask和marcotask应该大家都比较明白，不明白的可以随便翻翻资料或者看看libuv的event loop，很好理解。\\nisolate->SetFatalErrorHandler(OnFatalError);这个从字面意思上来看是对程序的致命错误进行处理，没有细看，感觉可以直接过。\\nissue5,这里贴一下图片，这样还能清晰看到边上clion的备注。Locker主要的作用是对当前的scope添加互斥锁。exit_code = Start 这里的Start有很多玄机，接下来我们单独开一章节详细剖析一下。\\n三、node执行过程中发生了什么\\n\\nissue5\\n\\n1.node::Environment::Start\\n\\nissue5\\n这个函数对node运行时候的环境做了初始化，其中初始化了大家非常熟悉的HandleScope，Context,下面还有对uv_idle_init以及uv_timer_init等初始化的操作，这里就不过多介绍了。\\n\\n2.async_hooks和LoadEnvironment\\n\\n接下来注意这段代码：\\n\\n    env.async_hooks()->push_async_ids(1, 0);\\n    LoadEnvironment(&env);\\n    env.async_hooks()->pop_async_id(1);\\n这里引入了一个新的概念就是async_hooks，从这段代码就能看出来async_hooks是如何记录整个生命周期的，因为他是在生命周期之前推入，而又是在生命周期之后推出的。\\n\\nLoadEnvironment则是整个运行时候的环境，接下来会讲解到LoadEnvironment到底都做了什么。\\n\\n3.node::LoadEnvironment\\n\\nvoid LoadEnvironment(Environment* env) {\\n  HandleScope handle_scope(env->isolate());\\n  TryCatch try_catch(env->isolate());\\n  try_catch.SetVerbose(false);\\n  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\\n                                                    \\\"bootstrap_node.js\\\");\\n  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\\n  if (try_catch.HasCaught())  {\\n    ReportException(env, try_catch);\\n    exit(10);\\n  }\\n  CHECK(f_value->IsFunction());\\n  Local<Function> f = Local<Function>::Cast(f_value);\\n  Local<Object> global = env->context()->Global();//创建Global\\n  //...\\n  try_catch.SetVerbose(true);\\n  env->SetMethod(env->process_object(), \\\"_rawDebug\\\", RawDebug);\\n  global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \\\"global\\\"), global);\\n  Local<Value> arg = env->process_object();//创建process\\n  f->Call(Null(env->isolate()), 1, &arg);//通过bootstrap_node.js中的startup方法来调用本地node代码\\n}\\n在这里重点说一下很有名的bootstrap_node.js，这是外部js文件的入口，外部js文件进来之后要经过几个主要的步骤：通过vm.script 校验代码；通过preloadModules()预加载模块；通过module.rumMain()执行外部js文件。\\n\\n在内存分配的时候，有个小知识点，正好在这里提一下：\\n\\nbool large_object = size_in_bytes > kMaxRegularHeapObjectSize;\\n  HeapObject* object = nullptr;\\n  AllocationResult allocation;\\n  if (NEW_SPACE == space) {\\n    if (large_object) {\\n      space = LO_SPACE;\\n    } else {\\n      allocation = new_space_->AllocateRaw(size_in_bytes, alignment);\\n      if (allocation.To(&object)) {\\n        OnAllocationEvent(object, size_in_bytes);\\n      }\\n      return allocation;\\n    }\\n  }\\n大家可以注意一下这段代码，相信懂英文的人都能看懂，这里是对大对象进行判断，如果字节超过kMaxRegularHeapObjectSize则会被分配到LO_SPACE中。在这里给大家解释一下这个space，node中做堆内存分配的space细分总共五类，分别是：\\n\\nLO_SPACE（存放大对象）\\nNEW_SPACE（能被copying collector复制收集法收集的内存，主要是未被回收过的，为什么叫复制收集请自行查阅Scavenge算法）\\nOLD_SPACE（主要存放的是对NEW_SPACE的指针以及NEW_SPACE迁移过来的对象）\\nCODE_SPACE（存放经过turbofan优化后的指令对象）\\nMAP_SPACE（主要用于存放map）\\n还有游离于这几类之外的UNREACHABLE（容错处理，不做讨论）\\n其中NEW_SPACE的内存是连续的，OLD_SPACE和MAP_SAPCE则是基于页进行管理的，存放不下的话会不断新加内存页进来，直到max_size。LO_SPACE则是有单独的存储空间，也是基于页进行管理（所以粗分其实只有三类）。 下面贴一部分OLD_SPACE内存分配代码：\\nint paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;\\n  initial_max_old_generation_size_ = max_old_generation_size_ =\\n      Max(static_cast<size_t>(paged_space_count * Page::kPageSize),\\n          max_old_generation_size_);\\n//其中 kPageSize 定义如下\\nclass MemoryChunk{\\n  public:\\n    //省略\\n    static const int kPageSize = 1 << kPageSizeBits;//kPageSizeBits 与操作系统内存页大小有关\\n    //省略\\n}\\nclass Page : public MemoryChunk{\\n//省略\\n}\\n还有一个知识点，就是node内置模块是如何加载的，在这里不做展开讨论了，网上资料很多，请自行查阅。\\n\\n四、运行结束\\n\\n运行结束之后的工作就做过多解释了，大家简单看下代码直接过了，无非是一些扫尾的工作：\\n\\nif (trace_enabled) {\\n    v8_platform.StopTracingAgent();\\n  }\\n  v8_initialized = false;\\n  V8::Dispose();\\n  v8_platform.Dispose();\\n\\n  delete[] exec_argv;\\n  exec_argv = nullptr;\\n五、总结\\n\\n至此，整体流程也就大致清晰了，文章比较干，还是希望大家真正上手调试走一遍流程，看一下代码，这样印象才能更深刻，如果文章中有说的不正确的地方，也请大神在评论中进行指正。\\nby 小菜\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"好，测试测试\",\n            \"_id\": \"5a018409ec9e0358be71b6b6\",\n            \"replyChildList\": [\n              {\n                \"userName\": \"admin\",\n                \"content\": \"cedcece\",\n                \"_id\": \"5a02b1fa1454aa15ea3fc094\",\n                \"replyTime\": \"2017-11-08T07:27:54.476Z\"\n              },\n              {\n                \"userName\": \"admin\",\n                \"content\": \"vfvfvfvf\",\n                \"_id\": \"5a02b1fd1454aa15ea3fc095\",\n                \"replyTime\": \"2017-11-08T07:27:57.826Z\"\n              }\n            ],\n            \"replyTime\": \"2017-11-07T09:59:37.197Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"dwdwdwdw\",\n            \"_id\": \"5a02b1d11454aa15ea3fc093\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-08T07:27:13.357Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![3679cddbc799f.jpg](http://7xpyje.com1.z0.glb.clouddn.com/3679cddbc799f.jpg)\",\n            \"_id\": \"5a0426df36119115add2f7fe\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-09T09:58:55.424Z\"\n          }\n        ],\n        \"replyNum\": 0,\n        \"viewed\": 55,\n        \"creatDate\": \"2017-11-07T09:59:14.294Z\"\n      },\n      {\n        \"_id\": \"5a0273281454aa15ea3fc088\",\n        \"title\": \"Promise 必知必会（十道题）\",\n        \"content\": \"Promise 想必大家十分熟悉，想想就那么几个 api，可是你真的了解 Promise 吗？本文根据 Promise 的一些知识点总结了十道题，看看你能做对几道。\\n\\n题目一\\n\\nconst promise = new Promise((resolve, reject) => {\\n  console.log(1)\\n  resolve()\\n  console.log(2)\\n})\\npromise.then(() => {\\n  console.log(3)\\n})\\nconsole.log(4)\\n题目二\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve('success')\\n  }, 1000)\\n})\\nconsole.log(promise)\\npromise\\n  .then(() => {\\n    console.log(promise)\\n    throw new Error('error!!!')\\n  })\\n  .catch(err => {\\n    console.log(promise)\\n  })\\n题目三\\n\\nconst promise = new Promise((resolve, reject) => {\\n  resolve('success1')\\n  reject('error')\\n  resolve('success2')\\n})\\n\\npromise\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目四\\n\\nPromise.resolve(1)\\n  .then((res) => {\\n    console.log(res)\\n    return 2\\n  })\\n  .catch((err) => {\\n    return 3\\n  })\\n  .then((res) => {\\n    console.log(res)\\n  })\\n题目五\\n\\nconst promise = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    console.log('once')\\n    resolve('success')\\n  }, 1000)\\n})\\n\\nconst start = Date.now()\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\npromise.then((res) => {\\n  console.log(res, Date.now() - start)\\n})\\n题目六\\n\\nPromise.resolve()\\n  .then(() => {\\n    return new Error('error!!!')\\n  })\\n  .then((res) => {\\n    console.log('then: ', res)\\n  })\\n  .catch((err) => {\\n    console.log('catch: ', err)\\n  })\\n题目七\\n\\nconst promise = Promise.resolve()\\n  .then(() => {\\n    return promise\\n  })\\npromise.catch(console.error)\\n题目八\\n\\nPromise.resolve(1)\\n  .then(2)\\n  .then(Promise.resolve(3))\\n  .then(console.log)\\n题目九\\n\\nPromise.resolve()\\n  .then(function success (res) {\\n    throw new Error('error')\\n  }, function fail1 (e) {\\n    console.error('fail1: ', e)\\n  })\\n  .catch(function fail2 (e) {\\n    console.error('fail2: ', e)\\n  })\\n题目十\\n\\nprocess.nextTick(() => {\\n  console.log('nextTick')\\n})\\nPromise.resolve()\\n  .then(() => {\\n    console.log('then')\\n  })\\nsetImmediate(() => {\\n  console.log('setImmediate')\\n})\\nconsole.log('end')\\n结果\\n\\n执行结果及解释见我的知乎文章：https://zhuanlan.zhihu.com/p/30797777\",\n        \"author\": \"qichangjun\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 13,\n        \"creatDate\": \"2017-11-08T02:59:52.646Z\"\n      },\n      {\n        \"_id\": \"5a02afed1454aa15ea3fc092\",\n        \"title\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"content\": \"# Marked in browser\\\\n\\\\nRendered by **marked**.\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 5,\n        \"creatDate\": \"2017-11-08T07:19:09.451Z\"\n      },\n      {\n        \"_id\": \"5a04051036119115add2f7fc\",\n        \"title\": \"7\",\n        \"content\": \"7\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 1,\n        \"creatDate\": \"2017-11-09T07:34:40.844Z\"\n      },\n      {\n        \"_id\": \"5a04051a36119115add2f7fd\",\n        \"title\": \"8\",\n        \"content\": \"8\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-09T07:34:50.919Z\"\n      },\n      {\n        \"_id\": \"5a0506db1ec94d036d812378\",\n        \"title\": \"swdwd\",\n        \"content\": \"wdqdqds\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [],\n        \"replyNum\": 0,\n        \"viewed\": 0,\n        \"creatDate\": \"2017-11-10T01:54:35.907Z\"\n      },\n      {\n        \"_id\": \"5a050d461ec94d036d812379\",\n        \"title\": \"123323\",\n        \"content\": \"123132323\",\n        \"author\": \"admin\",\n        \"__v\": 0,\n        \"replyList\": [\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![c1582528660fa.jpg](http://7xpyje.com1.z0.glb.clouddn.com/c1582528660fa.jpg)\",\n            \"_id\": \"5a05134490b7a44ed3e4eeaa\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-10T02:47:32.384Z\"\n          },\n          {\n            \"userName\": \"admin\",\n            \"content\": \"![070a81e206771.png](http://7xpyje.com1.z0.glb.clouddn.com/070a81e206771.png)\\n\\n    console.log(12345)\",\n            \"_id\": \"5a096bfd391f055b03517241\",\n            \"replyChildList\": [],\n            \"replyTime\": \"2017-11-13T09:55:09.129Z\"\n          }\n        ],\n        \"replyNum\": 2,\n        \"viewed\": 10,\n        \"creatDate\": \"2017-11-10T02:21:58.308Z\"\n      }\n    ],\n    \"totalElement\": 8\n  }\n}"
*************** response log end ***************

